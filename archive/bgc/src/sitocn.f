      SUBROUTINE SITOCN(I)
C-------------------------
C  SITOC CALCULATES THE PROPORTION OF TOTAL SITE LEAF AREA CONTRIBUTED
C  BY AN ENTITY. THIS PROPORTION IS USED AS AN INDICATOR OF RELATIVE
C  SITE OCCUPANCY BY AN ENTITY. IT IS USED TO DEFINE THE GROUND SURFACE AREA
C  NEEDED FOR CALCULATION OF AVAILABLE SOIL WATER.
c
C MODIFICATION: 7/24/03 AJM.  NEW METHOD--> OCCUPANCY BASED ON ROOT BIOMASS 
C INSTEAD OF LEAF AREA.
C TEMPORARILY COOPTING BETA.DAT PARAMETER B2(13) (HERETOFORE UNUSED) AS A FLAG.
C USER CAN DICTATE WHICH METHOD TO USE VIA THIS PARAMETER FLAG.
C
C CHANGE HEREIN TODAY (11/14/03) ACCOMPANIES CHANGE IN SETLEAFN
C WHEREBY GRASS LEAVES WERE TURNED OFF FOR DAYS 120-210 (PREVIOUSLY THEY WERE 
C ON DURING THIS PERIOD)
C
C REVISING LOGIC AGAIN AJM 11/18/03.  
C COMMENTING OUT SECTION DEALING WITH REALLOCATING EACH ENTITY'S BUCKET RATIO 
C WHICH IS (WAS) ALTERED AS GRASSES TURNED ON OR OFF.  TREE'S RATIO WON'T
C SIGNIFICANTLY CHANGE BY OMITTING THIS TEST.  WHAT WILL CHANGE BY LEAVING THIS
C OUT IS THAT EACH TREE WILL GET A VERY SLIGHT BIT LESS WHEN/IF GRASSES ARE "OFF".
C HOWEVER, FOR THIS VERSION, I'M TURNING GRASSES ON ALL YEAR ANYWAY (EXCEPT
C WILL TEST A NEW PROCEDURE WHEREBY GRASS LEAVES WILL BE OFF IF SNOW IS DEEP.
C [BUT GRASS ROOTS WILL STILL BE ON TO RESPIRE]).
C
C WITHOUT THIS CHANGE, TREES' BUCKETS GET BIGGER WHEN GRASS ROOTS OFF (BY A
C SLIGHT AMOUNT, WITH SUM TOTAL OF EACH TREES BUCKET-INCREMENT BEING WHAT
C GRASSES HAD IF THEY WERE ON.  WITH THIS CHANGE, THEY WILL HAVE SAME BUCKET
C SIZE.  EACH TREE'S BUCKET SIZE RELATIVE TO ALL OTHERS WILL BE IDENTICAL
C (UNDER EITHER SCENARIO).
C NOTE THAT BY REMOVING THE TEST BELOW, GRASSES STILL "OCCUPY" THE SITE WHEN 
C "OFF" HENCE STILL HAVE A BUCKET WHEN OFF.  THEY JUST DONT "DO" ANTHING WHEN
C OFF EXCEPT ROOT RESPIRATION) IN BGROWN.
C SO, ALTHOUGH TREES WILL HAVE A SLIGHTLY SMALLER BUCKET THIS WAY, THERE MAY
C BE REMAINING WATER ON SITE THE DAY AFTER TREES TRANSPIRE FROM THE WATER THAT
C DIDN'T GET INTO ANY TREE'S BUCKET THE PREVIOUS DAY (BECAUSE THEIR BUCKET WAS
C A BIT SMALLER).  THIS ON-SITE WATER WILL GET 'REDISTRIBUTED" ACROSS THE SITE
C THE NEXT MORNING, AND AVAILABLE TO FILL BUCKETS.
C
C THIS 11/18/03 CHANGE BEING SAVED AS "SITOCN3"
C
C-------------------------
      INCLUDE 'SITE.F77'
      INCLUDE 'ENTITY.F77'
C For tree entities:
C If CCF is less than 100, then available growing space is that
C proportion (CCF/100) times AREA (10,000m2).
C !!! added 7/26/95. KSM
C
C Calculate OCPNCY based on active leaf area only. Subtract grass
c leaf area before and after leaf on/off dates.
      BARE=(S(9)/100)*AREA  !area of bare, unoccupied ground
C**************************************************
C... changed 10/00 ajm --see below
C
C      RATIO(I)=LA(I)/SUMLA
C      IF(JD.LT.IGON .OR. JD.GT.IGOFF) THEN
C            ACTLA=SUMLA-SUMLA_GR
C            RATIO(I)=LA(I)/ACTLA
C            IF(ID(I).EQ.'G') RATIO(I)=0.0
C      ENDIF
C*******************************************************************
      IF(B2(13) .EQ.-1.)GOTO 10
C  Changed the code so that active LA is reduced if shrubs are present but
C  not active, hence occupancies will be adjusted accordingly.
      ACTLA=SUMLA
      RATIO(I)=LA(I)/ACTLA
C      IF(JD.LT.IGON .OR. JD.GT.IGOFF) THEN  !!11/03 AJM FOR FLAGSTAFF GRASSES
C      IF(JD.GE.IGON .AND. JD.LE.IGOFF) THEN !!          USE THIS
C            ACTLA=ACTLA-SUMLA_GR
C            RATIO(I)=LA(I)/ACTLA
C          IF(ID(I).EQ.'G') RATIO(I)=0.0
C      ENDIF
C      IF(JD.LT.ISON .OR. JD.GT.ISOFF) THEN
C            ACTLA=ACTLA-SUMLA_SH
C            RATIO(I)=LA(I)/ACTLA
C          IF(ID(I).EQ.'S') RATIO(I)=0.0
C      ENDIF
      GO TO 20
C*****************************************************************
  10  ACTV_RT=SUMRT
      RATIO(I)=ROOT(I)/ACTV_RT
C      IF(JD.LT.IGON .OR. JD.GT.IGOFF) THEN !!11/03 AJM (SEE ABOVE)
C      IF(JD.GE.IGON .AND. JD.LE.IGOFF) THEN
C            ACTV_RT=ACTV_RT-SUMRT_GR
C            RATIO(I)=ROOT(I)/ACTV_RT
C          IF(ID(I).EQ.'G') RATIO(I)=0.0
C      ENDIF
C      IF(JD.LT.ISON .OR. JD.GT.ISOFF) THEN
C            ACTV_RT=ACTV_RT-SUMRT_SH
C            RATIO(I)=ROOT(I)/ACTV_RT
C          IF(ID(I).EQ.'S') RATIO(I)=0.0
C      ENDIF

  20  OCPNCY(I)=RATIO(I)*(AREA-BARE)
C     IF (ID(I).EQ.'T') THEN
C     IF(SUMCCF.LT.100) OCPNCY(I)=RATIO(I)*AREA*SUMCCF/100
C       ENDIF
      RETURN
      END

