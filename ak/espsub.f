      SUBROUTINE ESPSUB (IFT)
      IMPLICIT NONE
C----------
C AK $Id$
C----------
C     PREDICTS THE PROBABILITY OF SUBSEQUENT SPECIES.
C----------
C
COMMONS
C
C
      INCLUDE 'PRGPRM.F77'
C
C
      INCLUDE 'ESPARM.F77'
C
C
      INCLUDE 'ESCOMN.F77'
C
C
      INCLUDE 'ESCOM2.F77'
C
C
      INCLUDE 'PLOT.F77'
C
C
      INCLUDE 'PDEN.F77'
C
C
      INCLUDE 'ESHAP.F77'
C
C 
      INCLUDE 'ESHAP2.F77'
C
C
COMMONS
C
C----------
C  VARIABLE DEFINITIONS:
C----------
C
C  IFT      -- STAND FOREST TYPE CATEGORY WHERE:
C                1 = 122
C                2 = 125
C                3 = 270
C                4 = 271
C                5 = 281
C                6 = 301
C                7 = 304
C                8 = 305
C                9 = 703
C               10 = 901
C               11 = 902
C               12 = 904
C               13 = 911
C               14 = OTHER (NO ADVANCED REGENERATION)
C  MAXSP    -- MAXIMUM NUMBER OF SPECIES, PASSED IN PRGPRM.F77
C  PNFT     -- FOREST TYPE COEFFICIENT (B1)
C  PNRDA    -- RELATIVE DENSITY COEFFICIENT (B2)
C  PBAPER   -- SPECIES BASAL AREA PERCENTAGE COEFFICIENT (B3)
C  PNEVEL   -- ELEVATION COEFFICIENT (B4)
C  PNSLO    -- SLOPE COEFFICIENT (B5)
C  PNTLAT   -- STAND LATTITUDE COEFFICIENT (B6)
C  PN       -- USED IN DETERMINING SPECIES PROBABILITY
C  XPRD     -- PLOT RELATIVE DENSITY >= REGNBK, PASSED IN AS 
C              PRDA(MAXPLOT) IN PDEN.F77
C  BAPER    -- PLOT SPECIES BASAL AREA PERCENTAGE>= REGNBK, 
C              PASSED IN AS OVER(MAXSP,MAXPLOT) IN PDEN.F77
C  ELEV     -- STAND ELEVATION (100S OF FEET), PASSED IN PLOT.F77
C  SLO      -- PLOT SLOPE IN PERCENT, PASSED IN ESCOMN.F77
C  TLAT     -- STAND LATTITUDE, PASSED IN PLOT.F77
C  NNID     -- BASE MODEL PLOT NUMBER, PASSE IN ESCOMN.F77
C  OCURFT   -- SPECIES OCCURANCE BY FOREST TYPE, 0=NO, 1=YES,
C              PASSED IN ESCOMN.F77
C  XESMLT   -- SPECIES MULTIPLIER, PASSED IN ESHAP.F77
C  PSUB     -- SPECIES PROBABILITY, PASSED TO ESCOM2.F77
C----------
C  VARIABLE DECLARATIONS:
C----------
C  
      INTEGER IFT, I, J
C
      REAL PN,PNFT(MAXSP),PNRDA(MAXSP),PBAPER(MAXSP),PNELEV(MAXSP), 
     & PNSLO(MAXSP),PNTLAT(MAXSP),B1,B2,B3,B4,B5,B6,XPRD,BAPER,DENOM
C
C----------
      DATA PNFT / 
     &   0.000000,   0.000000, 18.817286,  -4.335977, -7.418399,  
     &   0.000000, -14.016526, 12.068751,  16.252819, 75.068739,
     &  32.354249,   13.78331,  0.000000,   0.000000, -5.462809,
     &   -5.84166,   -5.84166, -8.425499, -12.263984, -8.425499,
     &   0.000000,   0.000000,  0.000000 /
      DATA PNRDA / 
     &   0.000000,  0.000000, -3.172524,  0.000000,  1.639782,  
     &   0.000000,  1.518889, -0.676038, -2.700185,  -1.52236, 
     &   1.589928, -0.486824,  0.000000,  0.000000,  0.735086,
     &  -1.222693, -1.222693,  0.065674, -0.208275,  0.065674,
     &   0.000000,  0.000000,  0.000000 /     
      DATA PBAPER / 
     &   0.000000,  0.000000, 5.079113, 0.000000, 3.157273,
     &   0.000000, 19.994743, 2.646809, 3.953284, 2.108739,
     &    7.85832,  5.827778, 0.000000, 0.000000, 4.820169,
     &   2.583459,  2.583459, 3.671029, 3.337865, 3.671029,
     &   0.000000, 0.000000, 0.000000 /
      DATA PNELEV /
     &   0.000000,  0.000000,  0.000523,  0.000000,  0.000528,  
     &   0.000000,  0.000132, -0.000399,  0.000000, -0.001116,
     &  -0.001031,  0.000279,  0.000000,  0.000000,  0.000000,
     &  -0.000481, -0.000481, -0.000346, -0.000629, -0.000346,
     &   0.000000,  0.000000,  0.000000 /     
      DATA PNSLO / 
     &  0.000000,  0.000000, -0.01001,  0.000000, -0.020931, 
     &  0.000000, -0.032239,  0.00969, -0.010135,  0.000000,
     &  0.009722, -0.006586, 0.000000,  0.000000, -0.023403,
     &  0.000000,  0.000000, 0.014331,  0.038488,  0.014331,
     &  0.000000,  0.000000, 0.000000 /      
      DATA PNTLAT / 
     &   0.000000,  0.000000, -0.347083,  0.000000,  0.082484, 
     &   0.000000,  0.181689,  -0.22536, -0.315744, -1.358471,
     &  -0.578117, -0.270099,  0.000000,  0.000000,  0.000000,
     &   0.082088,  0.082088,  0.086557,   0.17451,  0.086557,
     &   0.000000,  0.000000,  0.000000 /  
C     CALCULATE PLOT DENSITIES 
      XPRD = PRDA(NNID)
      DENOM = BAAA(NNID)
      IF(BAAA(NNID).LE.0.) DENOM=1.       
C     CYCLE THROUGH SPECIES TO COMPUTE SPECIES PROBABILITIES
      DO 5 J=1,MAXSP
C       SET COEFFICIENTS FOR COMPUTING PN
        B1 = PNFT(J)
        B2 = PNRDA(J)
        B3 = PBAPER(J)
        B4 = PNELEV(J)
        B5 = PNSLO(J)
        B6 = PNTLAT(J)
        BAPER = OVER(J,NNID)/DENOM
        PN = B1 + B2 * XPRD + B3 * BAPER + B4 * ELEV + 
     &       B5 * SLO + B6 * TLAT
        PSUB(J) = (EXP(PN)/(1 + EXP(PN))) * OCURFT(J,IFT) * XESMLT(J)
    5 CONTINUE
C  MAKE SURE SPECIES PROBABILITIES ARE BETWEEN 0 AND 1.
      DO 10 I=1,MAXSP
      IF(PSUB(I).LT.0.)PSUB(I)=0.
      IF(PSUB(I).GT.1.)PSUB(I)=1.
      IF(IFT.EQ.14) PSUB(I)=0.
   10 CONTINUE
C
      RETURN
      END

